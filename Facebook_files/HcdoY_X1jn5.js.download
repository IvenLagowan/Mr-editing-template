;/*FB_PKG_DELIM*/

__d("LSDeletePollAttachment",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d;return b.seq([function(c){return!1===!0?b.ftr(b.db.table(223).fetch([[[a[2]]]]),function(c){return b.i64.eq(c.pollId,a[2])&&b.i64.eq(c.threadKey,a[0])}).next().then(function(c,e){var f=c.done;c=c.value;return f?b.fe(b.ftr(b.db.table(16).fetch([[[a[0]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&c.attachmentFbid===a[1]&&(b.i64.eq(c.attachmentType,[0,7])||b.i64.eq(c.attachmentType,[0,0]))&&c.hasMedia===!1&&c.hasXma===!0&&b.i64.eq(c.ephemeralMediaState,d)}),function(a){return a["delete"]()}):(e=c.item,b.fe(b.ftr(b.db.table(16).fetch([[[a[0],e.lastUpdateMessageId,a[1]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&b.i64.eq([0,0],[0,0])&&c.messageId===e.lastUpdateMessageId&&c.attachmentFbid===a[1]&&(b.i64.eq(c.attachmentType,[0,7])||b.i64.eq(c.attachmentType,[0,0]))&&c.hasMedia===!1&&c.hasXma===!0&&b.i64.eq(c.ephemeralMediaState,d)}),function(a){return a["delete"]()}))}):b.ftr(b.db.table(38).fetch([[[a[2]]]]),function(c){return b.i64.eq(c.pollId,a[2])&&b.i64.eq(c.threadKey,a[0])}).next().then(function(c,e){var f=c.done;c=c.value;return f?b.fe(b.ftr(b.db.table(16).fetch([[[a[0]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&c.attachmentFbid===a[1]&&(b.i64.eq(c.attachmentType,[0,7])||b.i64.eq(c.attachmentType,[0,0]))&&c.hasMedia===!1&&c.hasXma===!0&&b.i64.eq(c.ephemeralMediaState,d)}),function(a){return a["delete"]()}):(e=c.item,b.fe(b.ftr(b.db.table(16).fetch([[[a[0],e.lastUpdateMessageId,a[1]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&b.i64.eq([0,0],[0,0])&&c.messageId===e.lastUpdateMessageId&&c.attachmentFbid===a[1]&&(b.i64.eq(c.attachmentType,[0,7])||b.i64.eq(c.attachmentType,[0,0]))&&c.hasMedia===!1&&c.hasXma===!0&&b.i64.eq(c.ephemeralMediaState,d)}),function(a){return a["delete"]()}))})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSUpdatePollAdminMessageSummary",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[];return b.seq([function(d){return b.ftr(b.db.table(38).fetch([[[a[0]]]]),function(c){return b.i64.eq(c.pollId,a[0])&&b.i64.eq(c.threadKey,a[1])&&([[0,2],[0,3]].some(function(a){return b.i64.eq(c.lastUpdateMessageEventType,a)})&&[[0,2],[0,3]].some(function(c){return b.i64.eq(a[4],c)})||[[0,4],[0,5]].some(function(a){return b.i64.eq(c.lastUpdateMessageEventType,a)})&&[[0,4],[0,5]].some(function(c){return b.i64.eq(a[4],c)}))&&b.i64.gt(a[3],c.lastUpdateMessageTimestampMs)&&c.lastUpdateMessageId!==a[2]}).next().then(function(d,e){var f=d.done;d=d.value;return f?0:(e=d.item,c[0]=e.lastUpdateMessageTimestampMs,b.db.table(12).fetch([[[a[1],b.merge({gt:c[0]},{lt:a[3]})]]]).next().then(function(f){var d=f.done;f.value;return d?b.seq([function(d){return b.fe(b.ftr(b.db.table(12).fetch([[[a[1],c[0],e.lastUpdateMessageId]]]),function(d){return b.i64.eq(d.threadKey,a[1])&&b.i64.eq([0,0],[0,0])&&b.i64.eq(d.timestampMs,c[0])&&d.messageId===e.lastUpdateMessageId}),function(a){return a["delete"]()})},function(c){return b.fe(b.ftr(b.db.table(12).fetch([[[a[1],a[3],a[2]]]]),function(c){return b.i64.eq(c.threadKey,a[1])&&b.i64.eq([0,0],[0,0])&&b.i64.eq(c.timestampMs,a[3])&&c.messageId===a[2]}),function(b){var c=b.update;b.item;return c({text:a[5]})})}]):0}))})},function(a){return b.resolve(d)}])}e.exports=a}),null);
__d("LSVerifyPollExists",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return a[5]===!0?c.seq([function(e){return c.db.table(223).fetch([[[a[1]]]]).next().then(function(e,h){var i=e.done;e=e.value;return i?c.seq([function(b){return c.db.table(9).fetch([[[a[0]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?d[3]=[0,1]:(e=b.item,d[8]=e.syncGroup,c.i64.neq(d[8],f)?d[7]=d[8]:d[7]=[0,1],d[3]=d[7])})},function(e){return d[5]=new c.Map(),d[5].set("thread_key",a[0]),d[5].set("poll_id",a[1]),d[5].set("sync_group",d[3]),d[5].set("is_cm_poll",!0),d[6]=c.toJSON(d[5]),c.sp(b("LSIssueNewTask"),"poll_point_query",[0,170],d[6],f,f,[0,0],[0,0],f,f,[0,0])},function(a){return d[1]=!1}]):(h=e.item,c.seq([function(b){return c.i64.gt(a[3],h.lastUpdateMessageTimestampMs)?c.fe(c.db.table(223).fetch([[[a[1]]]]),function(b){var c=b.update;b.item;return c({lastUpdateMessageId:a[2],lastUpdateMessageTimestampMs:a[3],lastUpdateMessageEventType:a[4]})}):c.resolve()},function(a){return d[1]=!0}]))})},function(a){return d[0]=d[1]}]):c.seq([function(e){return c.db.table(38).fetch([[[a[1]]]]).next().then(function(e,h){var i=e.done;e=e.value;return i?c.seq([function(b){return c.fe(c.ftr(c.db.table(38).fetch([[[a[1]]]]),function(b){return c.i64.eq(b.pollId,a[1])&&c.i64.lt(b.authorityLevel,[0,40])}),function(a){return a["delete"]()})},function(b){return c.db.table(38).add({pollId:a[1],authorityLevel:[0,40],threadKey:a[0],lastUpdateMessageId:a[2],lastUpdateMessageTimestampMs:a[3],lastUpdateMessageEventType:a[4]})},function(b){return c.db.table(9).fetch([[[a[0]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?d[3]=[0,1]:(e=b.item,d[8]=e.syncGroup,c.i64.neq(d[8],f)?d[7]=d[8]:d[7]=[0,1],d[3]=d[7])})},function(e){return d[5]=new c.Map(),d[5].set("thread_key",a[0]),d[5].set("poll_id",a[1]),d[5].set("sync_group",d[3]),d[5].set("is_cm_poll",!1),d[6]=c.toJSON(d[5]),c.sp(b("LSIssueNewTask"),"poll_point_query",[0,170],d[6],f,f,[0,0],[0,0],f,f,[0,0])},function(a){return d[1]=!1}]):(h=e.item,c.seq([function(b){return c.i64.gt(a[3],h.lastUpdateMessageTimestampMs)?c.fe(c.db.table(38).fetch([[[a[1]]]]),function(b){var c=b.update;b.item;return c({lastUpdateMessageId:a[2],lastUpdateMessageTimestampMs:a[3],lastUpdateMessageEventType:a[4]})}):c.resolve()},function(a){return d[1]=c.i64.eq(h.authorityLevel,[0,80])}]))})},function(a){return d[0]=d[1]}])},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);